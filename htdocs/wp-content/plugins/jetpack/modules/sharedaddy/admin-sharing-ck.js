(function(e){e(document).ready(function(){function t(){e(".preview a.sharing-anchor").unbind("mouseenter mouseenter").hover(function(){if(e(this).data("hasappeared")!==!0){var t=e(".sharing-hidden .inner"),n=e(this).parents("li"),r=setTimeout(function(){e(t).css({left:e(n).position().left+"px",top:e(n).position().top+e(n).height()+3+"px"}).slideDown(200,function(){e(n).data("hasappeared",!0).data("hasoriginal",!0).data("hasitem",!1);e(t).mouseleave(r).mouseenter(i);e(n).mouseleave(s).mouseenter(o);e(n).click(u)});var r=function(){e(n).data("hasitem",!1);if(e(n).data("hasoriginal")===!1){var t=setTimeout(u,800);e(n).data("timer2",t)}},i=function(){e(n).data("hasitem",!0);clearTimeout(e(n).data("timer2"))},s=function(){e(n).data("hasoriginal",!1);if(e(n).data("hasitem")===!1){var t=setTimeout(u,800);e(n).data("timer2",t)}},o=function(){e(n).data("hasoriginal",!0);clearTimeout(e(n).data("timer2"))},u=function(){t.slideUp(200);e(n).unbind("mouseleave",s).unbind("mouseenter",o);e(t).unbind("mouseleave",r).unbind("mouseenter",r);e(n).data("hasappeared",!1);e(n).unbind("click",u);return!1}},200);e(this).data("timer",r)}},function(){clearTimeout(e(this).data("timer"));e(this).data("timer",!1)})}function n(){var n,r=e("#button_style").val();e("#live-preview ul.preview li").remove();(e("#save-enabled-shares input[name=visible]").val()!=""||e("#save-enabled-shares input[name=hidden]").val()!="")&&e("#live-preview ul.preview").append(e("#live-preview ul.archive .sharing-label").clone());e("ul.services-enabled li").each(function(){if(e(this).hasClass("service")){var t=e(this).attr("id");e("#live-preview ul.preview").append(e("#live-preview ul.archive li.preview-"+t).clone())}});if(e("#save-enabled-shares input[name=hidden]").val()!=""){e("#live-preview ul.preview").append(e("#live-preview ul.archive .share-more").parent().clone());e(".sharing-hidden ul li").remove();e("ul.services-hidden li").each(function(t,n){if(e(this).hasClass("service")){var r=e(this).attr("id");e(".sharing-hidden .inner ul").append(e("#live-preview ul.archive .preview-"+r).clone())}});t()}e("#live-preview div.sharedaddy").removeClass("sd-social-icon");e("#live-preview li.advanced").removeClass("no-icon");if("icon"==r){e("#live-preview ul.preview div span").html("&nbsp;").parent().addClass("no-text");e("#live-preview div.sharedaddy").addClass("sd-social-icon")}else"official"==r?e("#live-preview ul.preview .advanced").each(function(t){!e(this).hasClass("preview-press-this")&&!e(this).hasClass("preview-email")&&!e(this).hasClass("preview-print")&&!e(this).hasClass("share-custom")&&e(this).find(".option a span").html("").parent().removeClass("sd-button").parent().attr("class","option option-smart-on")}):"text"==r&&e("#live-preview li.advanced").addClass("no-icon")}function r(){var t=this;e(this).parents("li:first").css("backgroundImage",'url("'+sharing_loading_icon+'")');e(this).parents("form").ajaxSubmit(function(r){if(r.indexOf("<!---")>=0){var i=r.substring(0,r.indexOf("<!--->")),s=r.substring(r.indexOf("<!--->")+6);e(t).is(":submit")===!0&&e(t).parents("li:first").replaceWith(i);e("#live-preview ul.archive li.preview-"+e(t).parents("form").find("input[name=service]").val()).replaceWith(s)}n();e(t).parents("li:first").removeAttr("style")});return e(t).is(":submit")===!0?!1:!0}function i(e){jQuery("."+e+"-extra-options").css({backgroundColor:"#ffffcc"}).fadeIn()}function s(e){jQuery("."+e+"-extra-options").fadeOut("slow")}function o(){e("#enabled-services h3 img").show();e("#enabled-services ul.services-enabled li.service").length>0?e("#drag-instructions").hide():e("#drag-instructions").show();e("#enabled-services li.service").length>0?e("#live-preview .services h2").hide():e("#live-preview .services h2").show();var t=[],r=[];e("ul.services-enabled li").each(function(){if(e(this).hasClass("service")){t[t.length]=e(this).attr("id");i(e(this).attr("id"))}});e("ul.services-available li").each(function(){e(this).hasClass("service")&&s(e(this).attr("id"))});e("ul.services-hidden li").each(function(){if(e(this).hasClass("service")){r[r.length]=e(this).attr("id");i(e(this).attr("id"))}});e("#save-enabled-shares input[name=visible]").val(t.join(","));e("#save-enabled-shares input[name=hidden]").val(r.join(","));n();e("#save-enabled-shares").ajaxSubmit(function(){e("#enabled-services h3 img").hide()})}function u(e,t){var n=e.parent(),r=n.find("li"),i=r.index(e)+1,s=r.length-1;if(n.hasClass("services-available"))return;if("left"===t){if(1===i)return;var u=e.prev(),a=e.detach();u.before(a);u.prev().focus()}if("right"===t){if(i===s)return;var f=e.next(),a=e.detach();f.after(a);f.next().focus()}o()}function a(t){var n,r=t.parent();r.hasClass("services-available")?n="services-enabled":r.hasClass("services-enabled")?n="services-hidden":n="services-available";var i=t.detach();e("."+n).prepend(i).find("li:first-child").focus();o()}function f(){e("#services-config a.remove").unbind("click").click(function(){var t=e(this).parent().next();e(this).parents("li:first").css("backgroundImage",'url("'+sharing_loading_icon+'")');t.ajaxSubmit(function(r){t.parents("li:first").fadeOut(function(){e(this).remove();n()})});return!1})}e("#enabled-services .services ul").sortable({receive:function(e,t){o()},stop:function(){o();e("li.service").enableSelection()},over:function(t,n){e(this).find("ul").addClass("dropping");e("#enabled-services li.end-fix").remove();e("#enabled-services ul").append('<li class="end-fix"></li>')},out:function(t,n){e(this).find("ul").removeClass("dropping");e("#enabled-services li.end-fix").remove();e("#enabled-services ul").append('<li class="end-fix"></li>')},helper:function(e,t){t.find(".advanced-form").hide();return t.clone()},start:function(t,n){e(".advanced-form").hide();e("li.service").disableSelection()},placeholder:"dropzone",opacity:.8,delay:150,forcePlaceholderSize:!0,items:"li",connectWith:"#available-services ul, #enabled-services .services ul",cancel:".advanced-form"});e("#available-services ul").sortable({opacity:.8,delay:150,cursor:"move",connectWith:"#enabled-services .services ul",placeholder:"dropzone",forcePlaceholderSize:!0,start:function(){e(".advanced-form").hide()}});e(".service").on("keydown",function(t){switch(t.keyCode){case 13:a(e(this));break;case 32:a(e(this));break;case 37:u(e(this),"left");break;case 39:u(e(this),"right");break;default:return!0}t.preventDefault()});e(".preview-hidden a").click(function(){e(this).parent().find(".preview").toggle();return!1});e("#new-service form").ajaxForm({beforeSubmit:function(){e("#new-service-form .error").hide();e("#new-service-form img").show();e("#new-service-form input[type=submit]").prop("disabled",!0)},success:function(t){e("#new-service-form img").hide();if(t=="1"){e("#new-service-form .inerror").removeClass("inerror").addClass("error");e("#new-service-form .error").show();e("#new-service-form input[type=submit]").prop("disabled",!1)}else document.location=document.location.href.replace(/&create_new_service=true/i,"")}});e("#button_style").change(function(){n();return!0}).change();e("input[name=sharing_label]").blur(function(){e("#live-preview h3.sd-title").text(e("<div/>").text(e(this).val()).html())});f();t()})})(jQuery);