function AtD_restore_text_area(){AtD.remove("content");var e=jQuery("#content").html();navigator.appName=="Microsoft Internet Explorer"&&(e=e.replace(/<BR.*?class.*?atd_remove_me.*?>/gi,"\n"));jQuery("#content").replaceWith(AtD.content_canvas);jQuery("#content").val(e.replace(/\&lt\;/g,"<").replace(/\&gt\;/g,">").replace(/\&amp;/g,"&"));jQuery("#content").height(AtD.height);if(AtD_qtbutton){jQuery(AtD_qtbutton).val(AtD.getLang("button_proofread","proofread"));jQuery(AtD_qtbutton).css({color:"#464646"});jQuery(AtD_qtbutton).siblings("input").andSelf().attr("disabled",!1)}if(AtD.autosave!=undefined)if(window.wp&&window.wp.autosave){window.wp.autosave.local.resume();window.wp.autosave.server.resume()}else autosave=AtD.autosave}function AtD_restore_if_proofreading(){AtD_qtbutton&&jQuery(AtD_qtbutton).val()==AtD.getLang("button_edit_text","edit text")&&AtD_restore_text_area()}function AtD_unbind_proofreader_listeners(){jQuery("#save-post, #post-preview, #publish, #edButtonPreview").unbind("focus",AtD_restore_if_proofreading);jQuery("#add_poll, #add_image, #add_video, #add_audio, #add_media").unbind("click",AtD_restore_if_proofreading);jQuery("#post").unbind("submit",AtD_restore_if_proofreading)}function AtD_bind_proofreader_listeners(){jQuery("#save-post, #post-preview, #publish, #edButtonPreview").focus(AtD_restore_if_proofreading);jQuery("#add_poll, #add_image, #add_video, #add_audio, #add_media").click(AtD_restore_if_proofreading);jQuery("#post").submit(AtD_restore_if_proofreading)}function AtD_check(e){var t;if(jQuery.isFunction(e)){t=e;AtD_qtbutton||(AtD_qtbutton=jQuery("#qt_content_AtD, #ed_AtD").get(0))}else{e.id||(e=e[0]);AtD_qtbutton=e}if(!jQuery("#content").size()){"undefined"!=typeof t&&t(0);AtD_restore_if_proofreading();return}if(jQuery(AtD_qtbutton).val()==AtD.getLang("button_edit_text","edit text"))AtD_restore_text_area();else{if(!AtD.height){AtD.height=jQuery("#content").height();AtD_bind_proofreader_listeners();jQuery("#edButtonPreview").attr("onclick",null).click(function(){AtD_restore_if_proofreading();switchEditors.go("content","tinymce")});AtD.content_canvas=jQuery("#content");AtD.autosave=autosave}jQuery(AtD_qtbutton).css({color:"red"}).val(AtD.getLang("button_edit_text","edit text")).attr("disabled",!0);var n=jQuery("#content").val().replace(/\&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;");if(navigator.appName=="Microsoft Internet Explorer"){n=n.replace(/[\n\r\f]/gm,'<BR class="atd_remove_me">');var r=jQuery('<div class="input" id="content" style="height: 170px">'+n+"</div>");jQuery("#content").replaceWith(r);r.css({overflow:"auto","background-color":"white",color:"black"})}else{jQuery("#content").replaceWith('<div class="input" id="content">'+n+"</div>");jQuery("#content").css({overflow:"auto","background-color":"white",color:"black","white-space":"pre-wrap"});jQuery("#content").height(AtD.height)}if(window.wp&&window.wp.autosave){window.wp.autosave.local.suspend();window.wp.autosave.server.suspend()}else autosave=function(){};jQuery(AtD_qtbutton).siblings("input").andSelf().attr("disabled",!0);AtD.check("content",{success:function(e){e==0&&typeof t!="function"&&alert(AtD.getLang("message_no_errors_found","No writing errors were found"));AtD_restore_if_proofreading()},ready:function(e){jQuery(AtD_qtbutton).attr("disabled",!1);typeof t=="function"&&t(e)},error:function(e){jQuery(AtD_qtbutton).attr("disabled",!1);typeof t=="function"?t(-1):alert(AtD.getLang("message_server_error","There was a problem communicating with the Proofreading service. Try again in one minute."));AtD_restore_if_proofreading()},editSelection:function(e){var t=prompt(AtD.getLang("dialog_replace_selection","Replace selection with:"),e.text());t!=null&&e.replaceWith(t)},explain:function(e){var t=screen.width/2-240,n=screen.height/2-190;window.open(e,"","width=480,height=380,toolbar=0,status=0,resizable=0,location=0,menuBar=0,left="+t+",top="+n).focus()},ignore:function(e){jQuery.ajax({type:"GET",url:AtD.rpc_ignore+encodeURI(e).replace(/&/g,"%26"),format:"raw",error:function(e,t,n){AtD.callback_f!=undefined&&AtD.callback_f.error!=undefined&&AtD.callback_f.error(t+": "+n)}})}})}}var AtD_qtbutton;if(typeof QTags!="undefined"&&QTags.addButton)jQuery(document).ready(function(e){QTags.addButton("AtD",AtD_l10n_r0ar.button_proofread,AtD_check)});else{edButtons[edButtons.length]=new edButton("ed_AtD","AtD","","","");jQuery(document).ready(function(e){e("#ed_AtD").replaceWith('<input type="button" id="ed_AtD" accesskey="" class="ed_button" onclick="AtD_check(this);" value="'+AtD_l10n_r0ar.button_proofread+'" />')})};